#!/bin/bash

PGSQL_INSTALL="/home/cheng/COLO/apps/pgsql/7000"

dbname="dbtest"
client_num=16
table_num=800
record_num=10000
server_ip="127.0.0.1"

per_responsible_table=$(($table_num / $client_num))
per_responsible_key=$(($record_num / $table_num))

rm cmd*
rm out*

for n in `seq 1 $client_num`;
do
	echo "BEGIN;" >> cmd${n}
	start=$(($n * $per_responsible_table - $per_responsible_table + 1))
	end=$(($n * $per_responsible_table))
	for z in `seq $start $end`;
	do
		echo "UPDATE employee${z} SET salary = $z WHERE id BETWEEN 0 AND 5 OR id BETWEEN 2000 AND 2005 OR id BETWEEN 4000 AND 4005 OR id BETWEEN 6000 AND 6005 OR id BETWEEN 8000 AND 8005;" >> cmd${n}
	done
	echo "END;" >> cmd${n}
done

for k in `seq 1 $client_num`;
do
	launch_client=`$PGSQL_INSTALL/install/bin/pgbench dbtest -h $server_ip -j 1 -c 1 -p 7000 -T 20 -f /home/cheng/cmd${k} > out${k}.txt 2>&1 &`
	echo "$launch_client"
done